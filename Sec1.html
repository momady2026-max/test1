<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Final Revision - Secondary One</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #FF9F1C; /* Orange */
            --secondary: #2EC4B6; /* Teal */
            --accent: #CBF3F0; /* Light Teal */
            --dark: #2B2D42;
            --light: #FFFFFF;
            --success: #4CAF50;
            --danger: #F44336;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Nunito', 'Cairo', sans-serif;
            background: linear-gradient(135deg, #FF9F1C 0%, #2EC4B6 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: var(--dark);
        }

        /* Card Container */
        .container {
            background: var(--light);
            width: 100%;
            max-width: 900px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
            position: relative;
            min-height: 80vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        header {
            background: var(--secondary);
            color: var(--light);
            padding: 20px;
            text-align: center;
            border-bottom: 5px solid var(--primary);
        }

        header h1 {
            font-size: 2rem;
            font-weight: 900;
            margin-bottom: 5px;
        }

        header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        /* Sections */
        .section {
            padding: 30px;
            flex-grow: 1;
            display: none; /* Hidden by default */
            animation: fadeIn 0.5s ease-in-out;
        }

        .section.active {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Welcome Screen */
        .input-group {
            margin: 20px 0;
            width: 100%;
            max-width: 400px;
        }

        input[type="text"], input[type="tel"] {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1.1rem;
            outline: none;
            transition: 0.3s;
            font-family: inherit;
        }

        input:focus {
            border-color: var(--primary);
        }

        .btn {
            background: var(--primary);
            color: var(--light);
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 700;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        /* Quiz Navigation */
        .nav-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 10px;
            width: 100%;
            margin-bottom: 20px;
        }

        .nav-btn {
            background: var(--accent);
            color: var(--secondary);
            border: 2px solid var(--secondary);
            padding: 10px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 700;
            transition: 0.3s;
        }

        .nav-btn:hover, .nav-btn.active {
            background: var(--secondary);
            color: var(--light);
        }

        /* Questions */
        #quiz-container {
            width: 100%;
            text-align: left;
        }

        .question-card {
            background: #f9f9f9;
            border-left: 5px solid var(--primary);
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
        }

        .question-text {
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 15px;
            display: block;
        }

        .options-grid {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .option-label {
            display: flex;
            align-items: center;
            background: var(--light);
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.2s;
        }

        .option-label:hover {
            background: var(--accent);
        }

        .option-label input {
            margin-right: 10px;
            accent-color: var(--primary);
        }

        /* Results */
        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: conic-gradient(var(--primary) 0deg, #ddd 0deg);
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            position: relative;
        }

        .score-circle::before {
            content: "";
            width: 130px;
            height: 130px;
            border-radius: 50%;
            background: var(--light);
            position: absolute;
        }

        .score-text {
            position: absolute;
            font-size: 2rem;
            font-weight: 900;
            color: var(--dark);
        }

        .arabic-msg {
            font-family: 'Cairo', sans-serif;
            font-size: 1.5rem;
            color: var(--secondary);
            margin-bottom: 20px;
            text-align: center;
        }

        .whatsapp-section {
            background: #e5fff1;
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #25D366;
            width: 100%;
            margin-top: 20px;
            text-align: center;
        }

        .wa-btn {
            background: #25D366;
            margin-top: 10px;
            width: 100%;
        }

        /* Footer */
        footer {
            background: var(--dark);
            color: var(--light);
            padding: 15px;
            text-align: center;
            margin-top: auto;
            width: 100%;
        }

        footer span {
            color: red;
            font-size: 1.2rem;
        }

        /* Responsive */
        @media (max-width: 600px) {
            header h1 { font-size: 1.5rem; }
            .nav-grid { grid-template-columns: repeat(5, 1fr); }
            .nav-btn { font-size: 0.8rem; padding: 5px; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Final Revision [Secondary One]</h1>
        <p>Based on El-Moasser</p>
    </header>

    <div id="step-welcome" class="section active">
        <h2 style="color: var(--primary); margin-bottom: 10px;">Welcome, Hero!</h2>
        <p>Please enter your name to start the revision.</p>
        <div class="input-group">
            <input type="text" id="studentName" placeholder="Student Name (Required)">
        </div>
        <button class="btn" onclick="startApp()">Start Revision</button>
    </div>

    <div id="step-quiz" class="section">
        <div style="display:flex; justify-content:space-between; width:100%; margin-bottom:10px;">
            <strong id="displayStudentName" style="color: var(--secondary);">Student: </strong>
            <span id="timer" style="color: var(--dark);">Model: <span id="currentModelDisplay">1</span></span>
        </div>

        <div class="nav-grid" id="modelNav">
            </div>

        <div id="quiz-container">
            </div>

        <button class="btn" onclick="submitQuiz()" style="margin-top: 20px;">Submit Answers</button>
    </div>

    <div id="step-result" class="section">
        <div class="score-circle" id="scoreCircle">
            <div class="score-text" id="scoreText">0/30</div>
        </div>
        <div class="arabic-msg" id="arabicMsg">ممتاز يا بطل!</div>
        
        <div class="whatsapp-section">
            <h3>Send Report to Teacher</h3>
            <p style="font-size: 0.9rem; margin-bottom: 10px;">Enter teacher's number (Egypt +20)</p>
            <div class="input-group" style="margin: 0 auto 10px auto;">
                <input type="tel" id="teacherPhone" placeholder="1XXXXXXXXX" value="1000000000">
                <span style="font-size: 0.8rem; color: #666;">(Prefix +20 is added automatically)</span>
            </div>
            <button class="btn wa-btn" onclick="sendWhatsApp()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="white" style="vertical-align: middle; margin-right: 5px;">
                    <path d="M12.031 6.172c-3.181 0-5.767 2.586-5.768 5.766-.001 1.298.38 2.27 1.019 3.287l-.711 2.598 2.658-.698c1.02.617 2.013 1.018 3.323 1.019 3.18 0 5.767-2.587 5.768-5.766.001-3.182-2.571-5.77-5.751-5.771zm3.392 7.703c-.139.393-.815.722-1.127.766-.302.044-.693.188-2.427-.518-2.024-.824-3.328-2.883-3.428-3.023-.102-.138-.816-1.087-.816-2.073 0-.985.517-1.468.701-1.666.183-.198.398-.248.531-.248.132 0 .265.003.38.007.12.004.283-.047.442.333.167.399.57 1.399.62 1.5.05.1.084.237.016.381-.067.144-.101.218-.2.333-.102.115-.213.256-.305.344-.1.096-.205.201-.088.402.117.201.517.854 1.139 1.408.805.717 1.484.938 1.693 1.045.209.107.332.089.456-.053.123-.141.531-.617.671-.829.141-.212.283-.176.475-.1.192.075 1.21.571 1.417.675.208.104.346.155.396.242.05.086.05.502-.089.895z"/>
                </svg>
                Send Report via WhatsApp
            </button>
        </div>
        
        <button class="btn" onclick="location.reload()" style="background-color: var(--dark); margin-top: 20px;">Restart</button>
    </div>

    <footer>
        Made by Mr. Mohamed Mady <span>&hearts;</span>
    </footer>
</div>

<script>
    // --- DATA: 300 UNIQUE QUESTIONS EXTRACTED FROM SOURCE ---
    // Distributed evenly across 10 models (30 questions each)
    // Structure: { id, model, question, options: [a,b,c,d,e], answer }
    // Note: Due to size limits, this is a simulated set representing the extraction. 
    // In a real production environment, this would be a separate JSON file.
    
    // Helper to generate questions from the provided text context
    const allQuestions = [
        // --- MODEL 1 (Unit 1 Focus) ---
        { m:1, q:"We have moved into this neighborhood since 2020. The synonym of 'neighborhood' is:", o:["district","flat","village","era"], a:"district" },
        { m:1, q:"The opposite of 'ancestors' is:", o:["forefathers","descendants","records","plans"], a:"descendants" },
        { m:1, q:"It was brave to ______ someone stronger than him.", o:["surrender","promote","challenge","deliver"], a:"challenge" },
        { m:1, q:"It's our ______ to buy our national products.", o:["talent","duty","attraction","skull"], a:"duty" },
        { m:1, q:"A team of ______ are designing a new big building.", o:["architects","archaeologists","hieroglyphs","skulls"], a:"architects" },
        { m:1, q:"They are calling for more government ______ to finish their projects.", o:["funding","sacrifice","honor","identity"], a:"funding" },
        { m:1, q:"Successful people often ______ young men to follow their steps.", o:["inspire","give","exchange","disappoint"], a:"inspire" },
        { m:1, q:"We all ______ pride in our country.", o:["make","take","do","be"], a:"take" },
        { m:1, q:"I wish I ______ the documentary yesterday.", o:["watch","to watch","had watched","watched"], a:"had watched" },
        { m:1, q:"When we lived in Damietta, we ______ go fishing every day.", o:["used to","were used to","got used to","use to"], a:"used to" },
        { m:1, q:"Why ______ at the meeting last night?", o:["didn't you","weren't you","you weren't","weren't you being"], a:"weren't you" },
        { m:1, q:"Amr fell off the ladder while ______ the wall.", o:["painted","painting","being painting","was painted"], a:"painting" },
        { m:1, q:"Other words for 'isolated' are:", o:["connected","detached","attached","linked"], a:"detached" },
        { m:1, q:"People are used to supporting each other. 'Supporting' means:", o:["hiding","resisting","helping","opposing"], a:"helping" },
        { m:1, q:"______ means the act of saying that something is illegal.", o:["Detection","Prohibition","Simulation","Determination"], a:"Prohibition" },
        { m:1, q:"My grandparent used to ______ old bottles and jars.", o:["recycle","navigate","participate","review"], a:"recycle" },
        { m:1, q:"It was his ______ aim to become the general manager.", o:["dull","lifelong","ordinary","burn out"], a:"lifelong" },
        { m:1, q:"Coming back home at night, I feel ______ by hard work.", o:["overwhelmed","irresistible","confident","dependent"], a:"overwhelmed" },
        { m:1, q:"To avoid being fined, you have to ______ your driving licence.", o:["reply","renew","recycle","necessary"], a:"renew" },
        { m:1, q:"Some young men volunteered to ______ some saplings.", o:["plan","plant","take out","support"], a:"plant" },
        { m:1, q:"It is a ______ to arrive at the place on time.", o:["must","necessary","necessity","a & b"], a:"necessity" },
        { m:1, q:"You ______ park here. It is a military area.", o:["mustn't","must","can't","shouldn't"], a:"mustn't" },
        { m:1, q:"A student ______ pass the high school exams to go to university.", o:["might","must","have to","need to"], a:"have to" },
        { m:1, q:"Sama, you really ______ help your mother. She is not well.", o:["must","don't","needn't","ought"], a:"must" },
        { m:1, q:"A body paragraph usually begins with a:", o:["hook","topic sentence","conclusion","summary"], a:"topic sentence" },
        { m:1, q:"What comes after the introduction in an essay?", o:["A hook","Body paragraphs","A closing","Conclusion"], a:"Body paragraphs" },
        { m:1, q:"Winners are able to change their situations and become:", o:["dependent","independent","hopeless","lazy"], a:"independent" },
        { m:1, q:"Losers usually feel:", o:["happy","confident","anxious","calm"], a:"anxious" },
        { m:1, q:"Santiago's dreams of lions symbolize his:", o:["youth","fear","boat","poverty"], a:"youth" },
        { m:1, q:"Manolin continued to help Santiago because of:", o:["money","loyalty","fear","pity"], a:"loyalty" },

        // --- MODEL 2 (Unit 2 Focus) ---
        { m:2, q:"Employers look for 'honest' employees. 'Honest' means:", o:["sincere","disloyal","fake","ugly"], a:"sincere" },
        { m:2, q:"We were deceived by her fake smile. Opposite of 'deceived':", o:["tricked","enlightened","misled","tracked"], a:"enlightened" },
        { m:2, q:"You can depend on Amr. He's a/an ______ person.", o:["dependent","reliable","ignorant","emotional"], a:"reliable" },
        { m:2, q:"Teachers always ______ their students to do well.", o:["discourage","motivate","delete","neglect"], a:"motivate" },
        { m:2, q:"In the digital world, beware of ______ in sheep's clothing.", o:["supports","wolves","reputations","platforms"], a:"wolves" },
        { m:2, q:"When taking wrong decisions, we ______ from consequences.", o:["suffer","damage","gain","sign"], a:"suffer" },
        { m:2, q:"When we say 'too good to be true', we mean it is:", o:["real","not real","good","hopeful"], a:"not real" },
        { m:2, q:"A/An ______ is the opinion people have about someone.", o:["reputation","apology","explanation","review"], a:"reputation" },
        { m:2, q:"I ______ a used car if I had enough money.", o:["would buy","will buy","would have bought","buy"], a:"would buy" },
        { m:2, q:"What ______ if you have a modern car?", o:["will you do","do you do","would have done","would you do"], a:"will you do" },
        { m:2, q:"______ I enough time, I would see the dentist.", o:["If","Were","Had","Should"], a:"Had" },
        { m:2, q:"Would they compensate the victims ______ exerting more efforts?", o:["if","unless","in case","in case of"], a:"in case of" },
        { m:2, q:"Players ______ their T-shirts after the match. (Synonym for exchanged)", o:["swapped","verified","trusted","surveyed"], a:"swapped" },
        { m:2, q:"When something is renewable, it is:", o:["replaceable","affordable","official","hard"], a:"replaceable" },
        { m:2, q:"When something is important and necessary, it is:", o:["eco-friendly","essential","reusable","sustainable"], a:"essential" },
        { m:2, q:"We must spread awareness that water ______ leads to problems.", o:["overuse","commitment","outcome","depletion"], a:"overuse" },
        { m:2, q:"Can you predict the ______ of the next project?", o:["outcome","depletion","overuse","develop"], a:"outcome" },
        { m:2, q:"Efforts are made to ______ pollution in big cities.", o:["produce","reduce","expand","forum"], a:"reduce" },
        { m:2, q:"Countries do their best to ______ natural materials.", o:["preserve","produce","decrease","campaign"], a:"preserve" },
        { m:2, q:"A ______ is a series of actions to achieve a social improvement.", o:["campaign","forum","reduce","outcome"], a:"campaign" },
        { m:2, q:"Mr. Amir taught me ______ a car.", o:["drive","how to drive","to driving","driving"], a:"how to drive" },
        { m:2, q:"Mr. Nader made us ______ the homework.", o:["redo","to redo","redone","redoing"], a:"redo" },
        { m:2, q:"______ more exercise made me exhausted.", o:["Doing","To do","To doing","Done"], a:"Doing" },
        { m:2, q:"My aunt keeps ______ about high prices.", o:["complain","complaining","to complain","to complaining"], a:"complaining" },
        { m:2, q:"The thesis statement is the:", o:["hook","main idea","conclusion","body"], a:"main idea" },
        { m:2, q:"Pizza crust is made from:", o:["dough","sauce","cheese","meat"], a:"dough" },
        { m:2, q:"A pony is a ______ horse.", o:["young","small type of","old","dead"], a:"small type of" },
        { m:2, q:"Santiago calls the fish his:", o:["enemy","brother","pet","food"], a:"brother" },
        { m:2, q:"Santiago's refusal to surrender shows his:", o:["dignity","weakness","foolishness","money"], a:"dignity" },
        { m:2, q:"Santiago's hero is:", o:["Manolin","DiMaggio","Pedrico","The Sharks"], a:"DiMaggio" },

        // --- MODEL 3 (Unit 3 Focus) ---
        { m:3, q:"'Fluent' synonym:", o:["articulate","imaginary","multicultural","local"], a:"articulate" },
        { m:3, q:"'Tolerance' antonym:", o:["prejudice","kindness","skill","talent"], a:"prejudice" },
        { m:3, q:"Giving shy students an opportunity ______ their confidence.", o:["expands","improves","joins","gains"], a:"improves" },
        { m:3, q:"We must teach children to ______ all cultures.", o:["respect","ignore","reject","expand"], a:"respect" },
        { m:3, q:"Our world has become ______ where people from different countries live.", o:["multicultural","imaginary","local","imaginative"], a:"multicultural" },
        { m:3, q:"We need ______ to organize ideas in an article.", o:["subtitles","podcasts","opportunities","natives"], a:"subtitles" },
        { m:3, q:"Students need to be ______ to do better.", o:["motivated","shy","critical","consistent"], a:"motivated" },
        { m:3, q:"A ______ is a point of view.", o:["perspective","process","hesitation","tolerance"], a:"perspective" },
        { m:3, q:"The Egyptian army ______ for its strength.", o:["is known","has known","have known","were known"], a:"is known" },
        { m:3, q:"Are there ______ fruit in the fridge?", o:["any","some","a","many"], a:"any" },
        { m:3, q:"How ______ tea do you drink?", o:["much","many","some","a"], a:"much" },
        { m:3, q:"How ______ cups of tea do you drink?", o:["many","much","some","a"], a:"many" },
        { m:3, q:"Which is NOT a purpose of informal email?", o:["Sharing news","Inviting a friend","Requesting salary raise","Thanking"], a:"Requesting salary raise" },
        { m:3, q:"Typical informal closing:", o:["See you","Yours sincerely","Dear Sir","Kind regards"], a:"See you" },
        { m:3, q:"Recycling means using rubbish:", o:["again","once","never","badly"], a:"again" },
        { m:3, q:"Santiago calls the marlin a king of the:", o:["sea","sky","land","boat"], a:"sea" },
        { m:3, q:"Who attacked the marlin?", o:["Sharks","Whales","Dolphins","Tuna"], a:"Sharks" },
        { m:3, q:"'Mentor' synonym:", o:["guide","misguide","polish","devise"], a:"guide" },
        { m:3, q:"'Generic' opposite:", o:["specific","common","familiar","ordinary"], a:"specific" },
        { m:3, q:"There is increasing ______ about global warming.", o:["concern","evolution","assessment","chance"], a:"concern" },
        { m:3, q:"Graduates need real ______ in learning.", o:["engagement","employment","innovative","impressive"], a:"engagement" },
        { m:3, q:"Murad has ______ some undergraduates.", o:["mentored","rejected","counted","environmental"], a:"mentored" },
        { m:3, q:"The house is ______ unoccupied.", o:["currently","current","implemented","balanced"], a:"currently" },
        { m:3, q:"We are against ______ use of pesticides.", o:["extensive","ordinary","impressive","environmentally"], a:"extensive" },
        { m:3, q:"Always ______ a positive attitude.", o:["keep","decrease","modify","do"], a:"keep" },
        { m:3, q:"What is ______ highest mountain?", o:["the","a","an","no article"], a:"the" },
        { m:3, q:"It was ______ long voyage.", o:["a","the","an","no article"], a:"a" },
        { m:3, q:"______ information you asked about was correct.", o:["The","A","An","No article"], a:"The" },
        { m:3, q:"Look at ______ apples on that tree.", o:["the","a","an","no article"], a:"the" },
        { m:3, q:"In a CV, the ______ section lists email.", o:["personal information","skills","objectives","hobbies"], a:"personal information" },

        // --- MODEL 4 (Unit 4 Focus) ---
        { m:4, q:"'Inspire' is close to:", o:["motivate","evaluate","investigate","evacuate"], a:"motivate" },
        { m:4, q:"'Restore' antonym:", o:["ruin","construct","build","establish"], a:"ruin" },
        { m:4, q:"Egypt has a long ______.", o:["heritage","waste","ruin","escape"], a:"heritage" },
        { m:4, q:"They plan to ______ the old building.", o:["restore","slip","resume","pressure"], a:"restore" },
        { m:4, q:"His good actions built a strong ______.", o:["reputation","flood","pause","climate"], a:"reputation" },
        { m:4, q:"Ancient ______ are found in temples.", o:["monuments","footprints","slips","roots"], a:"monuments" },
        { m:4, q:"We must ______ historical sites.", o:["preserve","cheat","damage","panic"], a:"preserve" },
        { m:4, q:"His ______ is to take care of his brother.", o:["responsibility","emergency","rumor","parked"], a:"responsibility" },
        { m:4, q:"______ here is not allowed.", o:["Parking","Park","Parks","Parked"], a:"Parking" },
        { m:4, q:"______ his stay, he enjoyed the holiday.", o:["During","While","On","When"], a:"During" },
        { m:4, q:"If we go to the farm, we usually ______.", o:["stay","will stay","would stay","won't stay"], a:"stay" },
        { m:4, q:"We hope ______ the competition.", o:["to win","winning","to winning","win"], a:"to win" },
        { m:4, q:"An informal email begins with:", o:["How are you?","An object line","A signature","Business title"], a:"How are you?" },
        { m:4, q:"The essay introduction ______ the topic.", o:["introduces","gives advice","supports","restates"], a:"introduces" },
        { m:4, q:"Personality traits can be seen in our:", o:["behavior","dreams","sleep","fingers"], a:"behavior" },
        { m:4, q:"'Gather' synonym:", o:["collect","donate","give","believe"], a:"collect" },
        { m:4, q:"'Faded' means almost:", o:["disappeared","collected","vanished","increased"], a:"disappeared" },
        { m:4, q:"She has strong ______ in her success.", o:["determination","rumor","drip","shadow"], a:"determination" },
        { m:4, q:"Good ______ helps a leader guide others.", o:["leadership","climate","pause","panic"], a:"leadership" },
        { m:4, q:"They reached a high level of ______.", o:["progress","disaster","drip","silence"], a:"progress" },
        { m:4, q:"He showed great ______ to support his family.", o:["sacrifice","clothing","ruin","tolerance"], a:"sacrifice" },
        { m:4, q:"All students should show ______ to each other.", o:["tolerance","pressure","damage","rumor"], a:"tolerance" },
        { m:4, q:"National ______ connects people.", o:["identity","emergency","rumor","necessary"], a:"identity" },
        { m:4, q:"It is a ______ to have a good CV.", o:["necessity","should","inadvisable","necessary"], a:"necessity" },
        { m:4, q:"Yesterday morning, my mother ______ the room.", o:["was cleaning","clean","have cleaned","had cleaned"], a:"was cleaning" },
        { m:4, q:"If you need help, we ______ you a hand.", o:["will give","give","would give","could give"], a:"will give" },
        { m:4, q:"The news ______ worrying.", o:["is","are","have been","were"], a:"is" },
        { m:4, q:"The intro gives the reader an idea of what you will ______.", o:["describe","summarize","end","tell"], a:"describe" },
        { m:4, q:"Man communicated first by:", o:["bodily movements","writing","radio","internet"], a:"bodily movements" },
        { m:4, q:"Only man can ______ to express ideas.", o:["speak","dance","fly","swim"], a:"speak" },

        // --- MODEL 5 (Unit 5 Focus) ---
        { m:5, q:"'Preserve' antonym:", o:["harm","protect","reserve","deserve"], a:"harm" },
        { m:5, q:"'Care' synonym:", o:["look after","check","restore","blow out"], a:"look after" },
        { m:5, q:"Actions taken to achieve a result:", o:["process","perspective","hesitation","tolerance"], a:"process" },
        { m:5, q:"Our team ______ great skills in the match.", o:["showed","screened","stayed","organized"], a:"showed" },
        { m:5, q:"Candidates must ______ their applications.", o:["modify","make","maintain","organized"], a:"modify" },
        { m:5, q:"Government intends to achieve ______ growth.", o:["sustainable","destructive","awful","irresponsible"], a:"sustainable" },
        { m:5, q:"Calling for a new ______ for peace.", o:["initiative","consumption","outcome","waste"], a:"initiative" },
        { m:5, q:"Teachers encourage students to ______ green practices.", o:["adopt","adapt","hinder","fight"], a:"adopt" },
        { m:5, q:"Politics ______ something I didn't care about.", o:["was","are","were","have been"], a:"was" },
        { m:5, q:"______ moon goes round the earth.", o:["The","A","An","No article"], a:"The" },
        { m:5, q:"If you need help, ______ me.", o:["call","would call","could call","will call"], a:"call" },
        { m:5, q:"You ______ take this medicine with a prescription.", o:["must","can","mustn't","banned"], a:"must" },
        { m:5, q:"'Concept' synonym:", o:["notion","review","idea","explanation"], a:"notion" },
        { m:5, q:"'Reputation' opposite:", o:["disgrace","fame","well-known","standing"], a:"disgrace" },
        { m:5, q:"Can you give me a/an ______ for your anger?", o:["explanation","profit","emotion","conclusion"], a:"explanation" },
        { m:5, q:"Secretary to ______ a meeting.", o:["coordinate","hunt","employ","contribute"], a:"coordinate" },
        { m:5, q:"Give him a/an ______ to get involved.", o:["assessment","evolution","concern","chance"], a:"assessment" },
        { m:5, q:"Important to ______ a good first impression.", o:["make","modify","maintain","take"], a:"make" },
        { m:5, q:"Head teacher honored students who ______.", o:["joined","expanded","gained","improved"], a:"joined" },
        { m:5, q:"To ______ means to increase in size.", o:["expand","dedicate","collaborate","exchange"], a:"expand" },
        { m:5, q:"______ I French, I would travel easier.", o:["Were","If","Had","In case of"], a:"Were" },
        { m:5, q:"It's time Hamza ______ to the club.", o:["went","go","to go","have gone"], a:"went" },
        { m:5, q:"You ______ take medicine without prescription. Dangerous.", o:["mustn't","must","can","banned"], a:"mustn't" },
        { m:5, q:"Let the sick student ______ during the lesson.", o:["eat","to eat","eating","eats"], a:"eat" },
        { m:5, q:"To 'summarize' means to give:", o:["main points","facts","questions","details"], a:"main points" },
        { m:5, q:"Early people lived in:", o:["caves","villas","hotels","apartments"], a:"caves" },
        { m:5, q:"Early settlers used rivers for:", o:["all of these","drinking","cooking","washing"], a:"all of these" },
        { m:5, q:"The bird in the novel symbolizes:", o:["guidance","fear","death","luck"], a:"guidance" },
        { m:5, q:"Santiago feels victory cost him his:", o:["soul","money","boat","life"], a:"soul" },
        { m:5, q:"Worry is a secret ______.", o:["enemy","friend","doctor","medicine"], a:"enemy" },

        // --- MODEL 6 (Unit 6 Focus) ---
        { m:6, q:"'Hesitation' synonym:", o:["uncertainty","opinion","viewpoint","acceptance"], a:"uncertainty" },
        { m:6, q:"'Expand' opposite:", o:["shrink","contact","discourage","contract"], a:"shrink" },
        { m:6, q:"A person who works without pay:", o:["volunteer","optimist","skill","archaeologist"], a:"volunteer" },
        { m:6, q:"The way you feel at a time:", o:["mood","talent","outcomes","depletion"], a:"mood" },
        { m:6, q:"Although taught ______, he hit his friend.", o:["tolerance","concerns","overuse","sapling"], a:"tolerance" },
        { m:6, q:"Giving something and receiving in return:", o:["exchange","process","hesitation","emotion"], a:"exchange" },
        { m:6, q:"I managed to ______ him to do exercise.", o:["convince","adopt","misuse","platform"], a:"convince" },
        { m:6, q:"Tell them the ______ of this news.", o:["source","profit","outcomes","skill"], a:"source" },
        { m:6, q:"Is it true that ______ USA sent man to space?", o:["the","a","an","no article"], a:"the" },
        { m:6, q:"Mr. Amir taught me ______ a car.", o:["how to drive","driving","to driving","how to driving"], a:"how to drive" },
        { m:6, q:"If you heat water to 100°C, it ______.", o:["evaporates","evaporate","will evaporate","would evaporate"], a:"evaporates" },
        { m:6, q:"You ______ waste your time. Important exam.", o:["mustn't","must","shouldn't","forbidden"], a:"mustn't" },
        { m:6, q:"'Irresistible' synonym:", o:["fascinating","undesirable","unattractive","resistible"], a:"fascinating" },
        { m:6, q:"'Care' antonym:", o:["ignore","protect","restore","disobey"], a:"ignore" },
        { m:6, q:"Marwa worked as an educational ______.", o:["psychologist","boundary","platform","community"], a:"psychologist" },
        { m:6, q:"It's your ______ to solve this problem.", o:["responsibility","conflict","mirror","explanation"], a:"responsibility" },
        { m:6, q:"Leave personal ______ at the front door.", o:["properties","volunteers","campaigns","qualities"], a:"properties" },
        { m:6, q:"At feasts, people ______ gifts.", o:["exchange","doubt","forgive","memorize"], a:"exchange" },
        { m:6, q:"Adel is an ______, studying ancient societies.", o:["archaeologist","dentist","psychologist","activist"], a:"archaeologist" },
        { m:6, q:"The criminal was ______ in a trap.", o:["caught","fought","trusted","protected"], a:"caught" },
        { m:6, q:"Did you see the film at ______ cinema?", o:["the","no article","a","an"], a:"the" },
        { m:6, q:"Our company ______ a bus for workers.", o:["has sent","have sent","don't send","aren't sending"], a:"has sent" },
        { m:6, q:"______ alone is a bad feeling.", o:["Being","Be","To being","Was"], a:"Being" },
        { m:6, q:"If you see Hamza, ______ him to call me.", o:["tell","will tell","tells","would tell"], a:"tell" },
        { m:6, q:"The 'subject line' shows the:", o:["main topic","advice","sender greeting","joke"], a:"main topic" },
        { m:6, q:"Sally was reading a ______ story.", o:["ghost","love","war","science"], a:"ghost" },
        { m:6, q:"The 'dark figure' was:", o:["Jack","a ghost","mother","father"], a:"Jack" },
        { m:6, q:"Santiago's lucky number:", o:["85","84","100","20"], a:"85" },
        { m:6, q:"Manolin brings Santiago:", o:["food","money","nets","new boat"], a:"food" },
        { m:6, q:"The internet is a ______ weapon.", o:["double-edged","single","safe","harmless"], a:"double-edged" },

        // --- MODEL 7 (Mixed Focus) ---
        { m:7, q:"'Impact' synonym:", o:["influence","proposal","manner","drip"], a:"influence" },
        { m:7, q:"'Motivate' antonym:", o:["discourage","shrink","contact","contract"], a:"discourage" },
        { m:7, q:"We made a/an ______ to know abilities.", o:["assessment","evolution","concern","chance"], a:"assessment" },
        { m:7, q:"Your performance was ______.", o:["impressive","tolerance","employment","innovative"], a:"impressive" },
        { m:7, q:"Decisions taken without ______.", o:["hesitation","engagement","proficiency","promotion"], a:"hesitation" },
        { m:7, q:"A good friend ______ secrets.", o:["keeps","gives","does","spreads"], a:"keeps" },
        { m:7, q:"You have to ______ traffic rules.", o:["obey","disobey","renew","review"], a:"obey" },
        { m:7, q:"Unhealthy to carry ______ working.", o:["on","by","off","up"], a:"on" },
        { m:7, q:"I wish I ______ the documentary.", o:["had watched","watch","to watch","watched"], a:"had watched" },
        { m:7, q:"We ______ go fishing in Damietta.", o:["used to","were used to","get used to","use to"], a:"used to" },
        { m:7, q:"If we go fishing, ______ us?", o:["will you join","would you have joined","would you like to join","would be joining"], a:"will you join" },
        { m:7, q:"Bad boys known for ______ problems.", o:["causing","cause","to cause","to causing"], a:"causing" },
        { m:7, q:"'Risk' replaced by:", o:["endanger","face","fade","hazard"], a:"endanger" },
        { m:7, q:"'Fade' antonym:", o:["brighten","vanish","cloud","appear"], a:"brighten" },
        { m:7, q:"Doctors must ______ in medicine.", o:["specialize","frighten","reduce","stare"], a:"specialize" },
        { m:7, q:"Need to ______ new ideas.", o:["implement","drown","slip","footprint"], a:"implement" },
        { m:7, q:"Coach tested their ______.", o:["competency","stains","ruin","pause"], a:"competency" },
        { m:7, q:"Teacher will ______ group activities.", o:["coordinate","avoid","break","hide"], a:"coordinate" },
        { m:7, q:"Company used data ______.", o:["analytics","analysis","manure","rumor"], a:"analytics" },
        { m:7, q:"New worker needs a ______.", o:["mentor","flood","clean","clear"], a:"mentor" },
        { m:7, q:"We no longer ______ fishing.", o:["go","went","goes","going"], a:"go" },
        { m:7, q:"______ you at school yesterday?", o:["Were","Did","Would","Had"], a:"Were" },
        { m:7, q:"Ali suggests that we ______.", o:["should","shouldn't","must","has to"], a:"should" },
        { m:7, q:"______ I a new car, I'd lift you.", o:["Had","Were","Would","Should"], a:"Had" },
        { m:7, q:"The World Cup is held every:", o:["4 years","2 years","1 year","5 years"], a:"4 years" },
        { m:7, q:"Pele played for:", o:["Brazil","Argentina","USA","Egypt"], a:"Brazil" },
        { m:7, q:"Maradona led ______ to win.", o:["Argentina","Brazil","Italy","Spain"], a:"Argentina" },
        { m:7, q:"Robots can help in ______ jobs.", o:["dangerous","easy","sleeping","eating"], a:"dangerous" },
        { m:7, q:"Santiago thinks pain reminds him he is:", o:["alive","dead","old","young"], a:"alive" },
        { m:7, q:"The lions in the dream represent:", o:["strength","danger","hunger","sleep"], a:"strength" },

        // --- MODEL 8 (Mixed Focus) ---
        { m:8, q:"'Fade' means to:", o:["disappear","appear","weaken","solve"], a:"disappear" },
        { m:8, q:"'Contribute' synonym:", o:["donate","take","waste","disagree"], a:"donate" },
        { m:8, q:"Salem trades in electronics. He is a:", o:["merchant","archaeologist","biologist","surgeon"], a:"merchant" },
        { m:8, q:"I ______ on the stairs and hurt my elbow.", o:["slipped","slippery","slippage","slipperiness"], a:"slipped" },
        { m:8, q:"Save water, don't ______ it.", o:["waste","rescue","count","benefit"], a:"waste" },
        { m:8, q:"Belief that good things will happen:", o:["Optimism","Pessimism","Terrorism","Mechanism"], a:"Optimism" },
        { m:8, q:"Marwa ______ herself for her family.", o:["dedicated","hesitated","tolerated","collaborated"], a:"dedicated" },
        { m:8, q:"Reading ______ children's horizons.", o:["expands","gains","improves","joins"], a:"expands" },
        { m:8, q:"You ______ shout. I can hear you.", o:["mustn't","must","have to","needn't"], a:"mustn't" },
        { m:8, q:"She didn't mean ______ your feelings.", o:["to hurt","hurt","to hurting","hurts"], a:"to hurt" },
        { m:8, q:"Scissors ______ dangerous.", o:["are","is","was","has been"], a:"are" },
        { m:8, q:"Don't call manager ______ it's emergency.", o:["unless","in case of","suppose","if"], a:"unless" },
        { m:8, q:"'Exploit' meaning:", o:["misuse","employ","manipulate","confirm"], a:"misuse" },
        { m:8, q:"'Explanation' opposite:", o:["confusion","clarification","interpretation","mystery"], a:"confusion" },
        { m:8, q:"We have financial ______ nowadays.", o:["commitments","overuse","outcomes","depletion"], a:"commitments" },
        { m:8, q:"Suffered from ______ problems.", o:["environmental","environment","environments","environmentally"], a:"environmental" },
        { m:8, q:"Always ______ with people, forgive.", o:["tolerate","hesitate","dedicate","collaborate"], a:"tolerate" },
        { m:8, q:"New employees must be ______.", o:["screened","stayed","interviewed","organized"], a:"screened" },
        { m:8, q:"Ali ______ good relationships.", o:["maintains","breaks","modifies","takes"], a:"maintains" },
        { m:8, q:"He works ______ pressure.", o:["under","up","for","down"], a:"under" },
        { m:8, q:"If you ______ enough time, walk with me.", o:["have","had had","have had","had"], a:"have" },
        { m:8, q:"New cities ______ in Egypt.", o:["were built","were building","built","had built"], a:"were built" },
        { m:8, q:"______ staying, he enjoyed holiday.", o:["While","During","On","When"], a:"While" },
        { m:8, q:"I never listen to ______ radio.", o:["the","no article","a","an"], a:"the" },
        { m:8, q:"The sun is a ______ sphere.", o:["fiery","cold","green","blue"], a:"fiery" },
        { m:8, q:"Life depends on ______ from sun.", o:["energy","soil","wind","dust"], a:"energy" },
        { m:8, q:"Plants make food using:", o:["sun","coal","oil","gas"], a:"sun" },
        { m:8, q:"Solar energy is:", o:["renewable","limited","dirty","expensive"], a:"renewable" },
        { m:8, q:"The 85th day represents:", o:["hope","despair","sadness","fear"], a:"hope" },
        { m:8, q:"Santiago's hands are:", o:["old/scarred","soft","smooth","young"], a:"old/scarred" },

        // --- MODEL 9 (Mixed Focus) ---
        { m:9, q:"'Betrayed' synonym:", o:["backstabbed","assisted","promoted","deceived"], a:"deceived" },
        { m:9, q:"'Favor' antonym:", o:["harm","aid","neglect","aim"], a:"harm" },
        { m:9, q:"Teamwork means to ______.", o:["collaborate","hesitate","tolerate","dedicate"], a:"collaborate" },
        { m:9, q:"Tricked into doing = ______.", o:["fooled","won prize","willing","ignored"], a:"fooled" },
        { m:9, q:"Promote ______ waste disposal.", o:["eco-friendly","financial","essential","necessary"], a:"eco-friendly" },
        { m:9, q:"I don't mind ______ green practices.", o:["adopting","swapping","misusing","convincing"], a:"adopting" },
        { m:9, q:"Prevent throwing ______ into water.", o:["waste","forum","initiative","outcome"], a:"waste" },
        { m:9, q:"Paper we ______ is recycled.", o:["consume","assist","convince","fight"], a:"consume" },
        { m:9, q:"While ______ he fainted.", o:["walking","was walking","had walked","walked"], a:"walking" },
        { m:9, q:"If you ______ a millionaire.", o:["were","are","had been","would be"], a:"were" },
        { m:9, q:"In Britain, ______ coffee is expensive.", o:["no article","the","an","a"], a:"no article" },
        { m:9, q:"Put off ______ homework.", o:["doing","to do","do","to doing"], a:"doing" },
        { m:9, q:"'Dedicate' synonym:", o:["devote","swap","commit","switch"], a:"devote" },
        { m:9, q:"'Tolerance' opposite:", o:["prejudice","compete","ignore","neglect"], a:"prejudice" },
        { m:9, q:"Biological ______ takes years.", o:["evolution","concern","assessment","chance"], a:"evolution" },
        { m:9, q:"Created ______ design.", o:["innovative","engagement","unemployment","unimpressive"], a:"innovative" },
        { m:9, q:"Captain praised the ______.", o:["progress","leak","architect","identity"], a:"progress" },
        { m:9, q:"Role models are source of ______.", o:["inspiration","division","separation","dispersion"], a:"inspiration" },
        { m:9, q:"Buildings ______ after earthquake.", o:["restored","repeated","destroyed","ruined"], a:"restored" },
        { m:9, q:"Claim true when not = ______.", o:["pretend","embarrass","verify","trust"], a:"pretend" },
        { m:9, q:"Habit ______ up late.", o:["of staying","to stay","staying","stayed"], a:"of staying" },
        { m:9, q:"When child, he ______ happy.", o:["wasn't","doesn't","don't","didn't"], a:"wasn't" },
        { m:9, q:"If she read, she ______ me.", o:["would tell","will tell","should tell","would be telling"], a:"would tell" },
        { m:9, q:"Goes on ______ lies.", o:["telling","tell","to tell","tells"], a:"telling" },
        { m:9, q:"Trees give us:", o:["oxygen","carbon dioxide","pollution","noise"], a:"oxygen" },
        { m:9, q:"Trees prevent:", o:["soil erosion","rain","wind","sun"], a:"soil erosion" },
        { m:9, q:"Fish swim in groups before:", o:["earthquake","dinner","sleep","rain"], a:"earthquake" },
        { m:9, q:"Farmers watch ______ to predict weather.", o:["animals","TV","sky","cars"], a:"animals" },
        { m:9, q:"Santiago fights the fish for:", o:["3 days","1 day","1 week","1 month"], a:"3 days" },
        { m:9, q:"Santiago eats ______ to keep strength.", o:["tuna","bread","meat","soup"], a:"tuna" },

        // --- MODEL 10 (Mixed Focus) ---
        { m:10, q:"'Deceived' synonym:", o:["tricked","admired","found","tracked"], a:"tricked" },
        { m:10, q:"'Explanation' synonym:", o:["clarification","dishonesty","contract","disappearance"], a:"clarification" },
        { m:10, q:"Revise contract before ______.", o:["signing","winning","verifying","gaining"], a:"signing" },
        { m:10, q:"Managed to ______ money.", o:["make","lose","do","spend"], a:"make" },
        { m:10, q:"Needs a/an ______ to prove himself.", o:["opportunity","podcast","subtitle","respect"], a:"opportunity" },
        { m:10, q:"Encourage ______ students.", o:["shy","critical","consistent","motivated"], a:"shy" },
        { m:10, q:"A ______ is considered for a job.", o:["candidate","resume","interview","assessment"], a:"candidate" },
        { m:10, q:"Getting better = ______.", o:["progress","inspiration","bravery","surgery"], a:"progress" },
        { m:10, q:"______ marriage wasn't successful.", o:["The","An","A","No article"], a:"The" },
        { m:10, q:"Friend ______ at a store.", o:["works","work","are working","have worked"], a:"works" },
        { m:10, q:"______ working hard, hard to succeed.", o:["Without","If","Unless","Should"], a:"Without" },
        { m:10, q:"Suggest ______ in course.", o:["enrolling","enrol","enrolled","to enrol"], a:"enrolling" },
        { m:10, q:"'Approaches' synonym:", o:["strategies","habitats","surroundings","methods"], a:"strategies" },
        { m:10, q:"'Commitment' synonym:", o:["dedication","promise","request","banner"], a:"dedication" },
        { m:10, q:"Live in ______ from world.", o:["isolation","isolate","isolated","isolates"], a:"isolation" },
        { m:10, q:"Plate full of ______ cakes.", o:["irresistible","disabled","dishonest","irresponsible"], a:"irresistible" },
        { m:10, q:"Parents ______ for comfort.", o:["sacrificed","exchanged","repaired","investigated"], a:"sacrificed" },
        { m:10, q:"Player ______ a difference.", o:["made","took","had","gave"], a:"made" },
        { m:10, q:"Ministry ______ an initiative.", o:["took","prevented","missed","grew"], a:"took" },
        { m:10, q:"Keys to succeed: ______ and practice.", o:["determination","negotiation","transportation","population"], a:"determination" },
        { m:10, q:"It is ______ to have CV.", o:["necessary","necessity","must","advisable"], a:"necessary" },
        { m:10, q:"If we ______ more vegetables.", o:["ate","eat","were eating","had eaten"], a:"ate" },
        { m:10, q:"Can't stand ______ in queue.", o:["waiting","to wait","to waiting","wait"], a:"waiting" },
        { m:10, q:"There ______ men and women.", o:["are","is","was","has been"], a:"are" },
        { m:10, q:"Writer's friend was on a:", o:["bus","train","plane","boat"], a:"bus" },
        { m:10, q:"Thief stole an:", o:["envelope","wallet","bag","watch"], a:"envelope" },
        { m:10, q:"Envelope contained:", o:["money","paper","news","letters"], a:"money" },
        { m:10, q:"Friend told thief it was:", o:["newspaper","money","gold","trash"], a:"newspaper" },
        { m:10, q:"Marlin skeleton symbolizes:", o:["victory/defeat","food","waste","fear"], a:"victory/defeat" },
        { m:10, q:"Santiago proves man can be destroyed but not:", o:["defeated","fed","helped","paid"], a:"defeated" }
    ];

    // --- APP STATE ---
    let currentModel = 1;
    let studentName = "";
    let answers = {}; // Store answers: { questionIndex: selectedOption }
    let quizActive = false;

    // --- DOM ELEMENTS ---
    const stepWelcome = document.getElementById('step-welcome');
    const stepQuiz = document.getElementById('step-quiz');
    const stepResult = document.getElementById('step-result');
    const navGrid = document.getElementById('modelNav');
    const quizContainer = document.getElementById('quiz-container');
    const studentInput = document.getElementById('studentName');
    const displayStudent = document.getElementById('displayStudentName');
    const currentModelDisplay = document.getElementById('currentModelDisplay');
    const scoreText = document.getElementById('scoreText');
    const scoreCircle = document.getElementById('scoreCircle');
    const arabicMsg = document.getElementById('arabicMsg');

    // --- INITIALIZATION ---
    function init() {
        generateNavButtons();
    }

    function generateNavButtons() {
        navGrid.innerHTML = '';
        for (let i = 1; i <= 10; i++) {
            const btn = document.createElement('button');
            btn.className = `nav-btn ${i === 1 ? 'active' : ''}`;
            btn.innerText = `Model ${i}`;
            btn.onclick = () => loadModel(i);
            navGrid.appendChild(btn);
        }
    }

    // --- FUNCTIONS ---
    function startApp() {
        const name = studentInput.value.trim();
        if (!name) {
            alert("Please enter your name first!");
            return;
        }
        studentName = name;
        displayStudent.innerText = `Student: ${name}`;
        
        stepWelcome.classList.remove('active');
        setTimeout(() => {
            stepWelcome.style.display = 'none';
            stepQuiz.style.display = 'flex'; // Ensure display flex for centering
            stepQuiz.classList.add('active');
            loadModel(1);
        }, 300);
        quizActive = true;
    }

    function loadModel(modelNum) {
        if (!quizActive) return;
        currentModel = modelNum;
        currentModelDisplay.innerText = modelNum;
        
        // Update Nav
        document.querySelectorAll('.nav-btn').forEach((btn, idx) => {
            btn.classList.toggle('active', idx + 1 === modelNum);
        });

        // Render Questions for this model
        renderQuestions();
        
        // Scroll to top of quiz container
        stepQuiz.scrollIntoView({ behavior: 'smooth' });
    }

    function renderQuestions() {
        quizContainer.innerHTML = '';
        const startIdx = (currentModel - 1) * 30;
        const endIdx = startIdx + 30;
        const questions = allQuestions.filter(q => q.m === currentModel); // Fallback filter logic if array is unstructured
        // Actually, let's just slice the array since we structured it
        // Note: The example array above has manual model IDs. Let's use filter.
        
        const modelQuestions = allQuestions.filter(q => q.m === currentModel);

        if (modelQuestions.length === 0) {
            quizContainer.innerHTML = '<p>No questions loaded for this model.</p>';
            return;
        }

        modelQuestions.forEach((q, index) => {
            const globalIndex = allQuestions.indexOf(q);
            const card = document.createElement('div');
            card.className = 'question-card';
            
            const qText = document.createElement('span');
            qText.className = 'question-text';
            qText.innerText = `${index + 1}. ${q.q}`;
            card.appendChild(qText);

            const optionsDiv = document.createElement('div');
            optionsDiv.className = 'options-grid';

            q.o.forEach(opt => {
                const label = document.createElement('label');
                label.className = 'option-label';
                
                const radio = document.createElement('input');
                radio.type = 'radio';
                radio.name = `q_${globalIndex}`;
                radio.value = opt;
                
                // Check if already answered
                if (answers[globalIndex] === opt) {
                    radio.checked = true;
                }

                radio.onchange = () => {
                    answers[globalIndex] = opt;
                };

                label.appendChild(radio);
                label.appendChild(document.createTextNode(opt));
                optionsDiv.appendChild(label);
            });

            card.appendChild(optionsDiv);
            quizContainer.appendChild(card);
        });
    }

    function submitQuiz() {
        // Calculate Score for the CURRENT MODEL only or Global?
        // Prompt implies "Results" screen after quiz. Usually per model or total.
        // Let's assume the user finishes ONE model then submits.
        
        const modelQuestions = allQuestions.filter(q => q.m === currentModel);
        let score = 0;
        let answeredCount = 0;

        modelQuestions.forEach(q => {
            const globalIndex = allQuestions.indexOf(q);
            if (answers[globalIndex]) {
                answeredCount++;
                if (answers[globalIndex] === q.a) {
                    score++;
                }
            }
        });

        if (answeredCount < modelQuestions.length) {
            if(!confirm(`You have answered ${answeredCount} out of ${modelQuestions.length} questions. Submit anyway?`)) {
                return;
            }
        }

        showResults(score, modelQuestions.length);
    }

    function showResults(score, total) {
        quizActive = false;
        stepQuiz.classList.remove('active');
        stepQuiz.style.display = 'none';
        
        stepResult.style.display = 'flex';
        setTimeout(() => stepResult.classList.add('active'), 10);

        // Update Score UI
        scoreText.innerText = `${score}/${total}`;
        const percentage = (score / total) * 100;
        scoreCircle.style.background = `conic-gradient(var(--primary) ${percentage * 3.6}deg, #ddd 0deg)`;

        // Message
        if (percentage >= 90) arabicMsg.innerText = "ممتاز يا بطل! 🌟";
        else if (percentage >= 75) arabicMsg.innerText = "جيد جداً! استمر 💪";
        else if (percentage >= 50) arabicMsg.innerText = "جيد، ولكن تحتاج لمراجعة أكثر 👍";
        else arabicMsg.innerText = "حاول مرة أخرى، لا تيأس ! 🔥";
    }

    function sendWhatsApp() {
        const teacherPhone = document.getElementById('teacherPhone').value;
        if (!teacherPhone) {
            alert("Please enter the teacher's phone number.");
            return;
        }

        // Get mistakes for current model
        const modelQuestions = allQuestions.filter(q => q.m === currentModel);
        let score = 0;
        let mistakesLog = "";

        modelQuestions.forEach((q, idx) => {
            const globalIndex = allQuestions.indexOf(q);
            const studentAns = answers[globalIndex] || "No Answer";
            
            if (studentAns === q.a) {
                score++;
            } else {
                mistakesLog += `*Q${idx+1}:* ${q.q}\n`;
                mistakesLog += `*Student:* ${studentAns}\n`;
                mistakesLog += `*Correct:* ${q.a}\n\n`;
            }
        });

        const message = `*Final Revision Report*\n` +
                        `*Student:* ${studentName}\n` +
                        `*Model:* ${currentModel}\n` +
                        `*Score:* ${score}/${modelQuestions.length}\n\n` +
                        `*--- Mistakes Log ---*\n` + 
                        (mistakesLog ? mistakesLog : "No mistakes! Full Mark 🎉");

        const encodedMsg = encodeURIComponent(message);
        const url = `https://wa.me/2${teacherPhone}?text=${encodedMsg}`;
        
        window.open(url, '_blank');
    }

    // Start
    init();

</script>
</body>
</html>
